<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link rel=stylesheet type="text/css" href="./index.css">
<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
</head>
<body>
<span style="font-family:Microsoft JhengHei;">
	<header>
	<div class = "mainheader">
		<a href="/index.html"><div id = "logo"><img src="/images/pet_logo.png" height=100%></div></a>
		<div id="sidelist_container">
			<ul class="sidelist">
				<li><a href="/index.html" style="text-decoration: none; color: black;">走失總覽</a></li>
				<li>｜</li>
				<li><a href="/index.html" style="text-decoration: none; color: black;">拾獲總覽</a></li>
				<li>｜</li>
				<li><a href="/new_lost.html" style="text-decoration: none; color: black;">我要刊登</a></li>
				<li>｜</li>
				<li><a href="/profile.html" style="text-decoration: none; color: black;">會員頁面</a></li>
			</ul>
		</div>
	</div>
	</header>
	<div class="userprofile">
		<div>登入成功, 資料如以下:</div></br>
		<div class="nameline">姓名:<div id="successname"></div></div></br>
		<div class="emailline">信箱:<div id="successemail"></div></div>
	</div>
<script>
var cookiesend = {};
function getcookie()
{
	var cookies = document.cookie.split(";");
	console.log(cookies);
	for(i=0;i<cookies.length;i++)
	{
		var c = cookies[i].trim();//去空白
		console.log("第"+i+"個cookie: "+c);
		console.log(c.indexOf("user="));
		if(c.indexOf("user=") >= 0)//回傳找到的第一個
		{
			//找到user cookie, 直接拿token去登入, 回傳會員資料
			console.log(i+" : 找到cookie");
			console.log(i+" : "+c.substring(5,c.length));
			cookiesend.cookie = c.substring(5,c.length);
			return("2");
		}
	}
}

var cookieresult = getcookie();
if(cookieresult == "2")
{
	console.log(cookiesend);
	$.ajax({
		contentType :"application/json",
		type: "POST",
		url: "/profile",
		data: JSON.stringify(cookiesend),
		success: function(res)
		{
			console.log(res);
			document.getElementById("successname").innerHTML = res.data.name;
			document.getElementById("successemail").innerHTML = res.data.email;
		},
		error: function(err)
		{
			console.log(err);
		},
		dataType: "json"
		});
}
else{
	document.location.href="/signin.html";
}

</script>
</span>
</body>
</html>