<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/css/bootstrap-multiselect.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel=stylesheet type="text/css" href="./index.css">
</head>
<body>
<span style="font-family:Microsoft JhengHei;">
	<header>
	<div class = "mainheader_index">
		<a href="/index.html"><div id = "logo"><img src="/images/pet_logo.png" height=100%></div></a>
		<div id="sidelist_container">
			<ul class="sidelist">
				<li><a href="/index.html" style="text-decoration: none; color: black;">走失/發現走失總覽</a></li>
				<li>｜</li>
				<li><a href="/success_case.html" style="text-decoration: none; color: black;">成功案例</a></li>
				<li>｜</li>
				<li><a href="/new_lost.html" style="text-decoration: none; color: black;">我要刊登</a></li>
				<li>｜</li>
				<li><a href="/profile.html" style="text-decoration: none; color: black;">會員頁面</a></li>
			</ul>
		</div>
	</div>
	</header>
	<div class="search_background">
	<img id="search_image" src="https://d2h10qrqll8k7g.cloudfront.net/person_project/image/bar(dog).jpg">
	<div id="bar_text">開始搜尋, 找出符合條件的走失寵物<div id="bar_row_button" onclick="row()" >開始使用</div></div>
	</div>
	<div id="select_title" style="text-align:center; background-color:white; font-weight:bold; padding-top:10px;">依條件搜尋</div>
	<form action="" id="select_form" method="GET" enctype="multipart/form-data">
	<div class="form_div">
		<div class="select_category">
			<input type="checkbox" id="lost" name="post_type" value="lost">
			<label for="lost">協尋</label>
			<input type="checkbox" id="find" name="post_type" value="find">
			<label for="find">拾獲</label>
		</div>
	</div>
	<div class="form_div">
		<div class="select_category">
			<input type="checkbox" id="cat" name="select_category" value="cat">
			<label for="cat">貓</label>
			<input type="checkbox" id="dog" name="select_category" value="dog">
			<label for="dog">狗</label>
		</div>
	</div>
	<div class="form_div">
	<select name="select_breed" multiple>
		<optgroup label="狗">
			<option value="米克斯">米克斯</option>
			<option value="貴賓">貴賓</option>
			<option value="柯基">柯基</option>
			<option value="哈士奇">哈士奇</option>
			<option value="黃金獵犬">黃金獵犬</option>
			<option value="拉布拉多">拉布拉多</option>
			<option value="柴犬">柴犬</option>
			<option value="秋田">秋田</option>
			<option value="古代牧羊犬">古代牧羊犬</option>
		</optgroup>
		<optgroup label="貓">
			<option value="混種貓">混種貓</option>
			<option value="摺耳貓">摺耳貓</option>
			<option value="金吉拉">金吉拉</option>
			<option value="波斯貓">波斯貓</option>
			<option value="金吉拉">金吉拉</option>
		</optgroup>
	</select>
	</div>
	<div class="form_div">
		<select name="select_color" multiple>
			<option value="黑">黑色</option>
			<option value="白">白色</option>
			<option value="咖啡">咖啡色</option>
			<option value="灰">灰色</option>
			<option value="橘">橘色</option>
		</select>
	</div>
	<div class="form_div">
		<div class="select_category">
			<input type="checkbox" id="male" name="select_gender" value="female">
			<label for="male">男</label>
			<input type="checkbox" id="female" name="select_gender" value="male">
			<label for="female">女</label>
		</div>
	</div>
	<div class="form_div" id="address_input">
		<input type="hidden" name="lost_address_lng"></input>
		<input type="hidden" name="lost_address_lat"></input>
		<input type="text" id="input_address" name="input_address" placeholder="依地點搜尋"></input></br>
		<div id="error_message" style="color: red; display: none;">此輸入為無效地址!!!</div>
	</div>
	<input id="submit" type="button" value="搜尋" style="width: 60px; height: 34px;">
	</form>
	<div class="body">
		<div class="index_body">
			<div class="pets" id="lost_pets"></div>
		</div>
	</div>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBqPLiFTzh0Hn0piEvo_AGElKvHPlHO7SM&libraries=places"></script>
<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/js/bootstrap-multiselect.js"></script>
<script>
	function row(){
		$('html, body').animate({
			scrollTop: $("#select_title").offset().top
		}, 500);
	}
	<!-- Initialize the plugin: -->
    $(document).ready(function() {
        $('[name="select_breed"]').multiselect();
        $('[name="select_color"]').multiselect();
    });
	//地址搜尋框
	var autocomplete;
	window.addEventListener('load', () => {
		var input = document.getElementsByName('input_address')[0];
		autocomplete = new google.maps.places.Autocomplete(input);
		google.maps.event.addListener(autocomplete, 'place_changed', function() {
			fillInAddress();
		});		
	});
	function fillInAddress(){
		var place = autocomplete.getPlace();
		document.getElementsByName("lost_address_lng")[0].value = place.geometry.location.lng();
		document.getElementsByName("lost_address_lat")[0].value = place.geometry.location.lat();
	};
	//googlt map code end
	//ajax 送出表單 code start
	document.getElementById("submit").addEventListener('click', function(){	
		if(document.getElementsByName("input_address")[0].value.length > 0){
			if(document.getElementsByName("lost_address_lng")[0].value.length == 0){
				//輸入地址且地址錯誤
				document.getElementById("error_message").style = "color: red; display: block";
			}else{
				ajax_search();
				document.getElementById("error_message").style = "display: none";
			}
		}else{
			ajax_search();
			document.getElementById("error_message").style = "display: none";
		}
	});
	//ajax 送出表單 code start*/
	window.addEventListener('load', () => {
		const xhr = new XMLHttpRequest();
		var url = "/lost_record?lost_status=finding";
		xhr.open("get", url);
		xhr.onload = function(){
			var pets = JSON.parse(this.response);
			if(pets.data.length == 0){
				//顯示目前沒有協尋中寵物
			}else{
				console.log(pets);
				append_data(pets.data);
			}
		}
		xhr.send();
	});
	function ajax_search(){
		$.ajax({
			contentType :"application/json",
			type: "GET",
			url: "/lost_record",
			data: $('#select_form').serialize(),
			success: function(res){
				console.log(res);
				document.getElementById("lost_pets").innerHTML = "";
				append_data(res.data);
			},
			error: function(err){
				console.log(err);
			},
			dataType: "json"
		});	
	}
	function append_data(data){
		for(i=data.length-1; i>=0; i--){
			var container_background = document.createElement("div");
			container_background.className = "container";
			var container = document.createElement("div");
			container.className = "content_container";
			var image_container = document.createElement("a");
			image_container.href = "/room?id="+data[i].id;
			var image = document.createElement("img");
			image.className = "image";
			image.src = data[i].picture;
			var image_div = document.createElement("div");
			image_div.className = "image_container";
			image_div.appendChild(image);
			image_container.appendChild(image_div);
			container.appendChild(image_container);
			var type = document.createElement("div");
			type.className = "type";
			type.style="text-align: center;";
			if(data[i].post_type == "lost"){				
				var pet_type = document.createTextNode("《協尋》");
			}else if(data[i].post_type == "find"){
				var pet_type = document.createTextNode("《發現走失》");			
			}
			type.appendChild(pet_type);
			container.appendChild(type);
			var location = document.createElement("div");
			location.className = "location";
			var pet_location = document.createTextNode(data[i].lost_location);
			location.appendChild(pet_location);
			var time = document.createElement("div");
			time.className = "time";
			var pet_time = document.createTextNode(data[i].lost_time);
			time.appendChild(pet_time);
			container.appendChild(location);
			container.appendChild(time);
			container_background.appendChild(container);
			document.getElementById("lost_pets").appendChild(container_background);
		}
	}
</script>
</body>
</html>