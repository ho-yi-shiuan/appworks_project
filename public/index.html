<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link rel=stylesheet type="text/css" href="./index.css">
</head>
<body>
<span style="font-family:Microsoft JhengHei;">
	<header>
	<div class = "mainheader_index">
		<a href="/index.html"><div id = "logo"><img src="/images/pet_logo.png" height=100%></div></a>
		<div id="sidelist_container">
			<ul class="sidelist">
				<li><a href="/index.html" style="text-decoration: none; color: black;">走失總覽</a></li>
				<li>｜</li>
				<li><a href="/index.html" style="text-decoration: none; color: black;">拾獲總覽</a></li>
				<li>｜</li>
				<li><a href="/new_lost.html" style="text-decoration: none; color: black;">我要刊登</a></li>
				<li>｜</li>
				<li><a href="/profile.html" style="text-decoration: none; color: black;">會員頁面</a></li>
			</ul>
		</div>
	</div>
	</header>
	<div class="search_background">
	<form action="" id="select_form" method="GET" enctype="multipart/form-data">
	<div class="form_div">請選擇類別</br>
		<input type="checkbox" name="select_category" value="dog" checked>狗
		<input type="checkbox" name="select_category" value="cat" checked>貓
	</div>
	<div class="form_div">請選擇品種(選貓要只剩貓的類別)</br>
		<select name="select_breed" multiple="multiple">
			<option value="米克斯">米克斯</option>
			<option value="貴賓">貴賓</option>
			<option value="柯基">柯基</option>
			<option value="哈士奇">哈士奇</option>
			<option value="黃金獵犬">黃金獵犬</option>
			<option value="拉布拉多">拉布拉多</option>
			<option value="柴犬">柴犬</option>
			<option value="秋田">秋田</option>
			<option value="古代牧羊犬">古代牧羊犬</option>
			<option value="混種貓">混種貓</option>
			<option value="摺耳貓">摺耳貓</option>
			<option value="金吉拉">金吉拉</option>
			<option value="波斯貓">波斯貓</option>
			<option value="金吉拉">金吉拉</option>
		</select>
	</div>
	<div class="form_div">請選擇顏色</br>
		<select name="select_color" multiple="multiple">
			<option value="黑">黑色</option>
			<option value="白">白色</option>
			<option value="咖啡">咖啡色</option>
			<option value="灰">灰色</option>
			<option value="橘">橘色</option>
		</select>
	</div>
	<div class="form_div">請選擇性別</br>
		<input type="checkbox" name="select_gender" value="female" checked>女
		<input type="checkbox" name="select_gender" value="male" checked>男
	</div>
	<div class="form_div" id="address_input">依地區搜尋</br>
		<input type="hidden" name="lost_address_lng"></input>
		<input type="hidden" name="lost_address_lat"></input>
		<input type="text" name="input_address"></input></br>
		<div id="error_message" style="color: red; display: none;">此輸入為無效地址!!!</div>
	</div>
	<input id="submit" type="button" value="搜尋">
	</form>
	</div>
	<div class="index_body">
		<div class="lost_pets">
		</div>
	</div>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBqPLiFTzh0Hn0piEvo_AGElKvHPlHO7SM&libraries=places"></script>
<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script>
	//地址搜尋框
	var autocomplete;
	window.addEventListener('load', () => {
		var input = document.getElementsByName('input_address')[0];
		autocomplete = new google.maps.places.Autocomplete(input);
		google.maps.event.addListener(autocomplete, 'place_changed', function() {
			fillInAddress();
		});		
	});
	function fillInAddress(){
		var place = autocomplete.getPlace();
		document.getElementsByName("lost_address_lng")[0].value = place.geometry.location.lng();
		document.getElementsByName("lost_address_lat")[0].value = place.geometry.location.lat();
	};
	//googlt map code end
	//ajax 送出表單 code start
	document.getElementById("submit").addEventListener('click', function(){
		console.log(document.getElementsByName("input_address")[0].value.length);
		console.log(document.getElementsByName("lost_address_lng")[0].value.length);		
		if(document.getElementsByName("input_address")[0].value.length > 0){
			if(document.getElementsByName("lost_address_lng")[0].value.length == 0){
				//輸入地址且地址錯誤
				document.getElementById("error_message").style = "color: red; display: block";
			}else{
				ajax_search();
				document.getElementById("error_message").style = "display: none";
			}
		}else{
			ajax_search();
			document.getElementById("error_message").style = "display: none";
		}
	});
	//ajax 送出表單 code start*/
	window.addEventListener('load', () => {
		const xhr = new XMLHttpRequest();
		var url = "/lost_record";
		xhr.open("get", url);
		xhr.onload = function(){
			var pets = JSON.parse(this.response);
			if(pets.data.length == 0){
				//顯示目前沒有協尋中寵物
			}else{
				console.log("123");
				append_data(pets.data);
			}
		}
		xhr.send();
	});
	function ajax_search(){
		$.ajax({
			contentType :"application/json",
			type: "GET",
			url: "/lost_record",
			data: $('#select_form').serialize(),
			success: function(res){
				console.log(res);
				document.getElementsByClassName("lost_pets")[0].innerHTML = "";
				append_data(res.data);
			},
			error: function(err){
				console.log(err);
			},
			dataType: "json"
		});	
	}
	function append_data(data){
		for(i=0; i<data.length; i++){
			var container_background = document.createElement("div");
			container_background.className = "container";
			var container = document.createElement("div");
			container.className = "content_container";
			var image_container = document.createElement("a");
			image_container.href = "/room?id="+data[i].id;
			var image = document.createElement("img");
			image.className = "image";
			image.src = data[i].picture;
			var image_div = document.createElement("div");
			image_div.className = "image_container";
			image_div.appendChild(image);
			image_container.appendChild(image_div);
			var name = document.createElement("div");
			name.className = "name";
			var pet_name = document.createTextNode(data[i].name);
			name.appendChild(pet_name);
			var location = document.createElement("div");
			location.className = "location";
			var pet_location = document.createTextNode(data[i].lost_location);
			location.appendChild(pet_location);
			var time = document.createElement("div");
			time.className = "time";
			var pet_time = document.createTextNode(data[i].lost_time);
			time.appendChild(pet_time);
			container.appendChild(image_container);
			container.appendChild(name);
			container.appendChild(location);
			container.appendChild(time);
			container_background.appendChild(container);
			document.getElementsByClassName("lost_pets")[0].appendChild(container_background);				
		}
	}
</script>
</body>
</html>