<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link rel=stylesheet type="text/css" href="./index.css">
<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
</head>
<body>
<div id="signin_page">
	<header>
	<div class = "mainheader">
		<a href="/index.html"><div id = "logo"><img src="/images/pet_logo.png" height=100%></div></a>
		<div id="sidelist_container">
			<ul class="sidelist">
				<li><a href="/index.html" style="text-decoration: none; color: black;">走失/發現走失總覽</a></li>
				<li>｜</li>
				<li><a href="/success_case.html" style="text-decoration: none; color: black;">成功案例</a></li>
				<li>｜</li>
				<li><a href="/new_lost.html" style="text-decoration: none; color: black;">我要刊登</a></li>
				<li>｜</li>
				<li><a href="/profile.html" style="text-decoration: none; color: black;">會員頁面</a></li>
			</ul>
		</div>
	</div>
	</header>
	<div class="insert">
		<div id="insert_content">
			<div id="form_logo"><img id="logo_member" src="images/pet_logo.png"></div>
			<div class="fb-login-button" data-width="" data-size="large" data-button-type="login_with" data-auto-logout-link="false" data-use-continue-as="false" scope="public_profile,email" onlogin="checkLoginState();"></div>
			<hr id="divider">
			<input type="text" id="email" style="font-size:15px" placeholder="請輸入信箱"></input></br>
			<input type="password" id="password" style="font-size:15px" placeholder="請輸入密碼"></input></br>
			<button id="submit" style="button" onclick="signin();">登入</button></br>
			<div id="signin"><a href="signup.html" style="text-decoration: none; color: white;">會員註冊</a></div>
	</div>
	<div class="success">
		<div>登入成功, 資料如以下:</div></br>
		<div class="nameline">姓名:<div id="successname"></div></div></br>
		<div class="emailline">信箱:<div id="successemail"></div></div>
	</div>
</div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v6.0"></script>
<script>
	function signin(){
		var signup_data = {
			provider:"native",
			email: document.getElementById("email").value,
			password: document.getElementById("password").value
		}
		console.log(signup_data);
		$.ajax({
			contentType :"application/json",
			type: "POST",
			url: "/signin",
			data: JSON.stringify(signup_data),
			success: function(res)
			{
				if(res == 2)
				{
					console.log("wrong email or password")
					document.getElementById("fail").innerHTML = "帳號或密碼錯誤, 請重新輸入";
					document.getElementsByClassName("success")[0].style.display = "none";
					document.getElementById("fail").style.display = "block";
				}
				else
				{
					console.log(res);
					console.log("success");
					document.location.href="profile.html";
					//document.getElementById("successname").innerHTML = res.data.user.name;
					//document.getElementById("successemail").innerHTML = res.data.user.email;
					//document.getElementsByClassName("success")[0].style.display = "block";
					//document.getElementById("fail").style.display = "none";
				}
			},
			error: function(err)
			{
				console.log(err);
			},
			dataType: "json"
			});	
	}
	var person = {name: "",picture: "",email: "",provider: "facebook"};
	function statusChangeCallback(response){
		console.log('statusChangeCallback: ');
		console.log(response.status);
		if (response.status === 'connected'){
			FB.api("/me?fields=name,email,picture.type(large)",function(userData){
				person.name = userData.name;
				person.email = userData.email;
				person.picture = userData.picture.data.url;
				console.log(userData.picture.data.url);
				$.ajax({
					type: "POST",
					url: "/signin",
					data: person,
					success: function(user_data){
						console.log(user_data);
						document.location.href="profile.html";
					},
					dataType: "json"
				});			
			});
		} else {
			//登入失敗
		}
	  }
	function checkLoginState(){
		FB.getLoginStatus(function(response){
			statusChangeCallback(response);
		});
	}
	window.fbAsyncInit = function() {
		FB.init({
			appId            : '2897888950235941',
			autoLogAppEvents : true,
			xfbml            : true,
			version          : 'v6.0'
		});
	};
	// 載入 FB SDK
	(function(d, s, id) {
		var js, fjs = d.getElementsByTagName(s)[0];
		if (d.getElementById(id)) return;
		js = d.createElement(s);
		js.id = id;
		js.src = "https://connect.facebook.net/zh_TW/sdk.js";
		fjs.parentNode.insertBefore(js, fjs);
	}(document, 'script', 'facebook-jssdk'));
</script>
</span>
</body>
</html>